{"version":3,"sources":["../src/single-spa-angularjs.js"],"names":["singleSpaAngularJS","defaultOpts","angular","domElementGetter","mainAngularModule","uiRouter","preserveGlobal","elementId","strictDi","template","undefined","userOpts","Error","opts","mountedInstances","bootstrap","bind","mount","unmount","Promise","resolve","then","window","containerEl","getContainerEl","bootstrapEl","document","createElement","id","appendChild","uiViewEl","setAttribute","innerHTML","instance","reject","get","$destroy","setTimeout","element"],"mappings":"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","file":"single-spa-angularjs.js","sourcesContent":["const defaultOpts = {\n  // required opts\n  angular: null,\n  domElementGetter: null,\n  mainAngularModule: null,\n\n  // optional opts\n  uiRouter: false,\n  preserveGlobal: false,\n  elementId: '__single_spa_angular_1',\n  strictDi: false,\n  template: undefined,\n};\n\nexport default function singleSpaAngularJS(userOpts) {\n  if (typeof userOpts !== 'object') {\n    throw new Error(`single-spa-angularjs requires a configuration object`);\n  }\n\n  const opts = {\n    ...defaultOpts,\n    ...userOpts,\n  };\n\n  if (!opts.angular) {\n    throw new Error(`single-spa-angularjs must be passed opts.angular`);\n  }\n\n  if (!opts.domElementGetter) {\n    throw new Error(`single-spa-angularjs must be passed opts.domElementGetter function`);\n  }\n\n  if (!opts.mainAngularModule) {\n    throw new Error(`single-spa-angularjs must be passed opts.mainAngularModule string`);\n  }\n\n  // A shared object to store mounted object state\n  const mountedInstances = {};\n\n  return {\n    bootstrap: bootstrap.bind(null, opts, mountedInstances),\n    mount: mount.bind(null, opts, mountedInstances),\n    unmount: unmount.bind(null, opts, mountedInstances),\n  };\n}\n\nfunction bootstrap(opts) {\n  return Promise.resolve();\n}\n\nfunction mount(opts, mountedInstances) {\n  return Promise\n    .resolve()\n    .then(() => {\n      window.angular = opts.angular;\n\n      const containerEl = getContainerEl(opts);\n      const bootstrapEl = document.createElement('div');\n      bootstrapEl.id = opts.elementId;\n\n      containerEl.appendChild(bootstrapEl);\n\n      if (opts.uiRouter) {\n        const uiViewEl = document.createElement('div');\n        uiViewEl.setAttribute('ui-view', opts.uiRouter === true ? \"\" : opts.uiRouter);\n        bootstrapEl.appendChild(uiViewEl);\n      }\n\n      if (opts.template) {\n        bootstrapEl.innerHTML = opts.template;\n      }\n\n      if (opts.strictDi) {\n        mountedInstances.instance = opts.angular.bootstrap(bootstrapEl, [opts.mainAngularModule], {strictDi: opts.strictDi})\n      } else {\n        mountedInstances.instance = opts.angular.bootstrap(bootstrapEl, [opts.mainAngularModule])\n      }\n  });\n}\n\nfunction unmount(opts, mountedInstances) {\n  return new Promise((resolve, reject) => {\n    mountedInstances.instance.get('$rootScope').$destroy();\n    getContainerEl(opts).innerHTML = '';\n\n    if (opts.angular === window.angular && !opts.preserveGlobal)\n      delete window.angular;\n\n    setTimeout(resolve);\n  });\n}\n\nfunction getContainerEl(opts) {\n  const element = opts.domElementGetter();\n  if (!element) {\n    throw new Error(`domElementGetter did not return a valid dom element`);\n  }\n\n  return element;\n}\n"]}