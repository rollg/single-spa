{"version":3,"sources":["../src/parcel.js"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;MAQqB,M;;;AAKnB,oBAAY,KAAZ,EAAmB;AAAA;;AAAA,kHACX,KADW;;AAAA,YAmFnB,SAnFmB,GAmFP,cAAM;AAChB,cAAK,EAAL,GAAU,EAAV;AACD,OArFkB;;AAAA,YAsFnB,YAtFmB,GAsFJ,UAAC,MAAD,EAAS,KAAT,EAAmB;AAChC,YAAI,MAAK,KAAL,CAAW,QAAX,IAAuB,WAAW,SAAtC,EAAiD;AAC/C;AACA;AACD;;AAED,cAAK,aAAL,GAAqB,CAAC,MAAK,aAAL,IAAsB,QAAQ,OAAR,EAAvB,EAClB,IADkB,CACb,YAAa;AACjB,cAAI,MAAK,SAAL,IAAkB,WAAW,SAAjC,EAA4C;AAC1C;AACA;AACD;;AAED,iBAAO,iCAAP;AACD,SARkB,EASlB,KATkB,CASZ,eAAO;AACZ,gBAAK,aAAL,GAAqB,QAAQ,OAAR,EAArB,CADY,CAC2B;AACvC,gBAAK,QAAL,CAAc,EAAC,UAAU,IAAX,EAAd;;AAEA,cAAI,OAAO,IAAI,OAAf,EAAwB;AACtB,gBAAI,OAAJ,iBAAyB,MAAzB,mCAA4D,IAAI,OAAhE;AACD;;AAED,cAAI,MAAK,KAAL,CAAW,WAAf,EAA4B;AAC1B,kBAAK,KAAL,CAAW,WAAX,CAAuB,GAAvB;AACD,WAFD,MAEO;AACL,uBAAW,YAAM;AAAC,oBAAM,GAAN;AAAU,aAA5B;AACD;;AAED;AACA,gBAAM,GAAN;AACD,SAzBkB,CAArB;AA0BD,OAtHkB;;AAAA,YAuHnB,cAvHmB,GAuHF,YAAM;AACrB,YAAM,cAAc,OAAO,MAAP,CAAc,EAAd,EAAkB,MAAK,KAAvB,CAApB;;AAEA,eAAO,YAAY,WAAnB;AACA,eAAO,YAAY,MAAnB;AACA,eAAO,YAAY,QAAnB;AACA,eAAO,YAAY,QAAnB;AACA,eAAO,YAAY,WAAnB;AACA,eAAO,YAAY,cAAnB;;AAEA,eAAO,WAAP;AACD,OAlIkB;;AAGjB,YAAK,KAAL,GAAa;AACX,kBAAU;AADC,OAAb;;AAIA,UAAI,CAAC,MAAM,MAAX,EAAmB;AACjB,cAAM,IAAI,KAAJ,kMAAN;AACD;AATgB;AAUlB;;;;0CACmB;AAAA;;AAClB,aAAK,YAAL,CAAkB,OAAlB,EAA2B,YAAM;AAC/B,cAAM,cAAc,OAAK,KAAL,CAAW,WAAX,IAA0B,OAAK,WAAnD;AACA,cAAI,CAAC,WAAL,EAAkB;AAChB,kBAAM,IAAI,KAAJ,kVAAN;AAID;AACD,cAAI,mBAAJ;AACA,cAAI,OAAK,EAAT,EAAa;AACX,yBAAa,OAAK,EAAlB;AACD,WAFD,MAEO;AACL,mBAAK,iBAAL,GAAyB,aAAa,SAAS,aAAT,CAAuB,OAAK,KAAL,CAAW,QAAlC,CAAtC;AACA,mBAAK,KAAL,CAAW,QAAX,CAAoB,WAApB,CAAgC,UAAhC;AACD;AACD,iBAAK,MAAL,GAAc,YAAY,OAAK,KAAL,CAAW,MAAvB,aAAgC,sBAAhC,IAA+C,OAAK,cAAL,EAA/C,EAAd;AACA,iBAAK,MAAL,CAAY,YAAZ,CAAyB,IAAzB,CAA8B,OAAK,KAAL,CAAW,cAAzC;AACA,iBAAO,OAAK,MAAL,CAAY,YAAnB;AACD,SAlBD;AAmBD;;;2CACoB;AAAA;;AACnB,aAAK,YAAL,CAAkB,QAAlB,EAA4B,YAAM;AAChC,cAAI,OAAK,MAAL,IAAe,OAAK,MAAL,CAAY,MAA/B,EAAuC;AACrC,mBAAO,OAAK,MAAL,CAAY,MAAZ,CAAmB,OAAK,cAAL,EAAnB,CAAP;AACD;AACF,SAJD;AAKD;;;6CACsB;AAAA;;AACrB,aAAK,YAAL,CAAkB,SAAlB,EAA6B,YAAM;AACjC,cAAI,OAAK,MAAL,IAAe,OAAK,MAAL,CAAY,SAAZ,OAA4B,SAA/C,EAA0D;AACxD,mBAAO,OAAK,MAAL,CAAY,OAAZ,EAAP;AACD;AACF,SAJD;;AAMA,YAAI,KAAK,iBAAT,EAA4B;AAC1B,eAAK,iBAAL,CAAuB,UAAvB,CAAkC,WAAlC,CAA8C,KAAK,iBAAnD;AACD;;AAED,aAAK,SAAL,GAAiB,IAAjB;AACD;;;+BACQ;AAAA;;AACP,YAAI,KAAK,KAAL,CAAW,QAAf,EAAyB;AACvB,cAAI,oCAAoB,iCAAiB,QAAzC,EAAmD;AACjD,mBACE;AAAC,8CAAD,CAAkB,QAAlB;AAAA;AACG,wBAAC,OAAD,EAAa;AACZ,uBAAK,WAAL,GAAmB,UAAU,QAAQ,WAAlB,GAAgC,IAAnD;;AAEA,uBAAO,IAAP;AACD;AALH,aADF;AASD,WAVD,MAUO;AACL,mBAAO,IAAP;AACD;AACF,SAdD,MAcO;AACL,cAAM,WAAW,oCAAoB,iCAAiB,QAArC,GAEb;AAAC,4CAAD,CAAkB,QAAlB;AAAA;AACG,sBAAC,OAAD,EAAa;AACZ,qBAAK,WAAL,GAAmB,UAAU,QAAQ,WAAlB,GAAgC,IAAnD;;AAEA,qBAAO,IAAP;AACD;AALH,WAFa,GAUb,SAVJ;;AAYA,iBAAO,gBAAM,aAAN,CAAoB,KAAK,KAAL,CAAW,QAA/B,EAAyC,EAAC,KAAK,KAAK,SAAX,EAAzC,EAAgE,QAAhE,CAAP;AACD;AACF;;;;IAvFiC,gBAAM,S;;AAArB,Q,CACZ,Y,GAAe;AACpB,cAAU,KADU;AAEpB,oBAAgB,0BAAM,CAAE;AAFJ,G;oBADH,M","file":"index.js","sourcesContent":["/* This import statement requires a peer or dev dependency on react that is fulfilled at runtime.\n * To avoid duplicate bundling of react, we do not do this inside of single-spa-react.js.\n * We also do not set up the prop types in this file to avoid requiring the user of the library\n * to have prop-types installed and in their browser bundle, since not everyone uses prop types.\n */\nimport React from 'react'\nimport {SingleSpaContext} from '../lib/single-spa-react.js'\n\nexport default class Parcel extends React.Component {\n  static defaultProps = {\n    wrapWith: 'div',\n    parcelDidMount: () => {},\n  }\n  constructor(props) {\n    super(props)\n\n    this.state = {\n      hasError: false,\n    }\n\n    if (!props.config) {\n      throw new Error(`single-spa-react's Parcel component requires the 'config' prop to either be a parcel config or a loading function that returns a promise. See https://github.com/CanopyTax/single-spa-react`)\n    }\n  }\n  componentDidMount() {\n    this.addThingToDo('mount', () => {\n      const mountParcel = this.props.mountParcel || this.mountParcel\n      if (!mountParcel) {\n        throw new Error(`\n\t\t\t\t  <Parcel /> was not passed a mountParcel prop, nor is it rendered where mountParcel is within the React context.\n\t\t\t\t  If you are using <Parcel /> within a module that is not a single-spa application, you will need to import mountRootParcel from single-spa and pass it into <Parcel /> as a mountParcel prop\t\n\t\t\t\t`)\n      }\n      let domElement;\n      if (this.el) {\n        domElement = this.el\n      } else {\n        this.createdDomElement = domElement = document.createElement(this.props.wrapWith)\n        this.props.appendTo.appendChild(domElement)\n      }\n      this.parcel = mountParcel(this.props.config, {domElement, ...this.getParcelProps()})\n      this.parcel.mountPromise.then(this.props.parcelDidMount)\n      return this.parcel.mountPromise\n    })\n  }\n  componentDidUpdate() {\n    this.addThingToDo('update', () => {\n      if (this.parcel && this.parcel.update) {\n        return this.parcel.update(this.getParcelProps())\n      }\n    })\n  }\n  componentWillUnmount() {\n    this.addThingToDo('unmount', () => {\n      if (this.parcel && this.parcel.getStatus() === \"MOUNTED\") {\n        return this.parcel.unmount()\n      }\n    })\n\n    if (this.createdDomElement) {\n      this.createdDomElement.parentNode.removeChild(this.createdDomElement)\n    }\n\n    this.unmounted = true\n  }\n  render() {\n    if (this.props.appendTo) {\n      if (SingleSpaContext && SingleSpaContext.Consumer) {\n        return (\n          <SingleSpaContext.Consumer>\n            {(context) => {\n              this.mountParcel = context ? context.mountParcel : null\n\n              return null\n            }}\n          </SingleSpaContext.Consumer>\n        )\n      } else {\n        return null\n      }\n    } else {\n      const children = SingleSpaContext && SingleSpaContext.Consumer\n        ? (\n          <SingleSpaContext.Consumer>\n            {(context) => {\n              this.mountParcel = context ? context.mountParcel : null\n\n              return null\n            }}\n          </SingleSpaContext.Consumer>\n        )\n        : undefined\n\n      return React.createElement(this.props.wrapWith, {ref: this.handleRef}, children)\n    }\n  }\n  handleRef = el => {\n    this.el = el\n  }\n  addThingToDo = (action, thing) => {\n    if (this.state.hasError && action !== 'unmount') {\n      // In an error state, we don't do anything anymore except for unmounting\n      return\n    }\n\n    this.nextThingToDo = (this.nextThingToDo || Promise.resolve())\n      .then((...args) => {\n        if (this.unmounted && action !== 'unmount') {\n          // Never do anything once the react component unmounts\n          return\n        }\n\n        return thing(...args)\n      })\n      .catch(err => {\n        this.nextThingToDo = Promise.resolve() // reset so we don't .then() the bad promise again\n        this.setState({hasError: true})\n\n        if (err && err.message) {\n          err.message = `During '${action}', parcel threw an error: ${err.message}`\n        }\n\n        if (this.props.handleError) {\n          this.props.handleError(err)\n        } else {\n          setTimeout(() => {throw err})\n        }\n\n        // No more things to do should be done -- the parcel is in an error state\n        throw err\n      })\n  }\n  getParcelProps = () => {\n    const parcelProps = Object.assign({}, this.props)\n\n    delete parcelProps.mountParcel\n    delete parcelProps.config\n    delete parcelProps.wrapWith\n    delete parcelProps.appendTo\n    delete parcelProps.handleError\n    delete parcelProps.parcelDidMount\n\n    return parcelProps\n  }\n}\n"]}