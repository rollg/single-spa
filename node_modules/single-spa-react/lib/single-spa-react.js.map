{"version":3,"sources":["../src/single-spa-react.js"],"names":[],"mappings":"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","file":"single-spa-react.js","sourcesContent":["/* We don't import parcel.component.js from this file intentionally. See comment\n * in that file for why\n */\n\n// React context that gives any react component the single-spa props\nexport let SingleSpaContext = null\n\nconst defaultOpts = {\n  // required opts\n  React: null,\n  ReactDOM: null,\n  rootComponent: null,\n  loadRootComponent: null,\n  domElementGetter: null,\n  suppressComponentDidCatchWarning: false,\n\n  // optional opts\n  domElementGetter: null, // only can be omitted if provided as a custom prop\n  parcelCanUpdate: true, // by default, allow parcels created with single-spa-react to be updated\n}\n\nexport default function singleSpaReact(userOpts) {\n  if (typeof userOpts !== 'object') {\n    throw new Error(`single-spa-react requires a configuration object`);\n  }\n\n  const opts = {\n    ...defaultOpts,\n    ...userOpts,\n  };\n\n  if (!opts.React) {\n    throw new Error(`single-spa-react must be passed opts.React`);\n  }\n\n  if (!opts.ReactDOM) {\n    throw new Error(`single-spa-react must be passed opts.ReactDOM`);\n  }\n\n  if (!opts.rootComponent && !opts.loadRootComponent) {\n    throw new Error(`single-spa-react must be passed opts.rootComponent or opts.loadRootComponent`);\n  }\n\n  if (!SingleSpaContext && opts.React.createContext) {\n    SingleSpaContext = opts.React.createContext()\n  }\n\n  const lifecycles = {\n    bootstrap: bootstrap.bind(null, opts),\n    mount: mount.bind(null, opts),\n    unmount: unmount.bind(null, opts),\n  };\n\n  if (opts.parcelCanUpdate) {\n    lifecycles.update = update.bind(null, opts)\n  }\n\n  return lifecycles\n}\n\nfunction bootstrap(opts, props) {\n  if (opts.rootComponent) {\n    // This is a class or stateless function component\n    return Promise.resolve()\n  } else {\n    // They passed a promise that resolves with the react component. Wait for it to resolve before mounting\n    return opts\n      .loadRootComponent()\n      .then(resolvedComponent => {\n        opts.rootComponent = resolvedComponent\n      })\n  }\n}\n\nfunction mount(opts, props) {\n  return new Promise((resolve, reject) => {\n\n    if (!opts.rootComponent.prototype.componentDidCatch && !opts.suppressComponentDidCatchWarning && atLeastReact16(opts.React)) {\n      console.warn(`single-spa-react: ${props.name || props.appName || props.childAppName}'s rootComponent should implement componentDidCatch to avoid accidentally unmounting the entire single-spa application.`);\n    }\n\n    const domElementGetter = chooseDomElementGetter(opts, props)\n\n    if (!domElementGetter) {\n      throw new Error(`Cannot mount react application '${props.appName || props.name}' without a domElementGetter provided in either opts or props`)\n    }\n\n    const whenFinished = function() {\n      resolve(this);\n    };\n\n\n    const rootComponentElement = opts.React.createElement(opts.rootComponent, props)\n    const elementToRender = SingleSpaContext ? opts.React.createElement(SingleSpaContext.Provider, {value: props}, rootComponentElement) : rootComponentElement\n    const domElement = getRootDomEl(domElementGetter)\n    const renderedComponent = reactDomRender({elementToRender, domElement, whenFinished, opts})\n    opts.domElement = domElement\n  })\n}\n\nfunction unmount(opts, props) {\n  return Promise\n    .resolve()\n    .then(() => {\n      opts.ReactDOM.unmountComponentAtNode(opts.domElement);\n    })\n}\n\nfunction update(opts, props) {\n  return new Promise((resolve, reject) => {\n    const whenFinished = function() {\n      resolve(this);\n    };\n\n    const rootComponentElement = opts.React.createElement(opts.rootComponent, props)\n    const elementToRender = SingleSpaContext ? opts.React.createElement(SingleSpaContext.Provider, {value: props}, rootComponentElement) : rootComponentElement\n    const renderedComponent = reactDomRender({elementToRender, domElement:opts.domElement, whenFinished, opts})\n  })\n}\n\nfunction getRootDomEl(domElementGetter) {\n  const el = domElementGetter();\n  if (!el) {\n    throw new Error(`single-spa-react: domElementGetter function did not return a valid dom element`);\n  }\n\n  return el;\n}\n\nfunction atLeastReact16(React) {\n  if (React && typeof React.version === 'string' && React.version.indexOf('.') >= 0) {\n    const majorVersionString = React.version.slice(0, React.version.indexOf('.'));\n    try {\n      return Number(majorVersionString) >= 16;\n    } catch(err) {\n      return false;\n    }\n  } else {\n    return false;\n  }\n}\n\nfunction chooseDomElementGetter(opts, props) {\n  props = props && props.customProps ? props.customProps : props\n  if (props.domElement) {\n    return () => props.domElement\n  } else if (props.domElementGetter) {\n    return props.domElementGetter\n  } else {\n    return opts.domElementGetter\n  }\n}\n\nfunction reactDomRender({opts, elementToRender, domElement, whenFinished}) {\n  if(opts.renderType === 'createRoot') {\n    return opts.ReactDOM.createRoot(domElement).render(elementToRender, whenFinished)\n  }\n\n  if(opts.renderType === 'hydrate') {\n    return opts.ReactDOM.hydrate(elementToRender, domElement, whenFinished)\n  }\n\n  // default to this if 'renderType' is null or doesn't match the other options\n  return opts.ReactDOM.render(elementToRender, domElement, whenFinished)\n}\n"]}